key config-key password-encrypt Password123
 password encryption aes
crypto pki trustpoint sampleTP
 revocation-check crl
!
sip-ua
 crypto signaling default trustpoint sampleTP cn-san-validate server
 transport tcp tls v1.2
 tcp-retry 1000
!
show crypto pki trustpool | include DigiCert
crypto pki trustpool import clean url http://www.cisco.com/security/pki/trs/ios_core.p7b
!
voice service voip
 ip address trusted list
  ipv4 x.x.x.x y.y.y.y
 mode border-element
 allow-connections sip to sip
 media statistics
 media bulk-stats
 no supplementary-service sip refer
 no supplementary-service sip handle-replaces
 fax protocol t38 version 0 ls-redundancy 0 hs-redundancy 0 fallback none
 stun
  stun flowdata agent-id 1 boot-count 4
  stun flowdata shared-secret 0 Password123$
 sip
  g729 annexb-all
  early-offer forced
  asymmetric payload full
!
voice class uri 100 sip
 host ipv4:192.168.80.13
!
voice class uri 200 sip
 pattern dtg=hussain2572.lgu
!
voice class uri 300 sip
 pattern :5065
!
voice class uri 302 sip
 pattern 192.168.80.60:5060
!
voice class codec 99
 codec preference 1 opus
 codec preference 2 g711ulaw
 codec preference 3 g711alaw
!
voice class stun-usage 200
 stun usage firewall-traversal flowdata
 stun usage ice lite
!
voice class srtp-crypto 200
 crypto 1 AES_CM_128_HMAC_SHA1_80
!
voice class sip-profiles 200
 rule 9 request ANY sip-header SIP-Req-URI modify "sips:(.*)" "sip:\1"
 rule 10 request ANY sip-header To modify "<sips:(.*)" "<sip:\1"
 rule 11 request ANY sip-header From modify "<sips:(.*)" "<sip:\1"
 rule 12 request ANY sip-header Contact modify "<sips:(.*)>" "<sip:\1;transport=tls>"
 rule 13 response ANY sip-header To modify "<sips:(.*)" "<sip:\1"
 rule 14 response ANY sip-header From modify "<sips:(.*)" "<sip:\1"
 rule 15 response ANY sip-header Contact modify "<sips:(.*)" "<sip:\1"
 rule 20 request ANY sip-header From modify ">" ";otg=hussain2572_lgu>"
 rule 30 request ANY sip-header P-Asserted-Identity modify "sips:(.*)" "sip:\1"
!
voice class dpg 100
 description Incoming WxC(DP200201) to IP PSTN(DP101)
 dial-peer 101 preference 1
!
voice class dpg 200
 description Incoming IP PSTN(DP100) to Webex Calling(DP200201)
 dial-peer 200201 preference 1
!
voice class dpg 300
 dial-peer 301 preference 1
 dial-peer 303 preference 1
!
voice class dpg 302
 dial-peer 305 preference 1
 dial-peer 307 preference 1
!
voice class server-group 301
 ipv4 192.168.80.60 port 5065
!
voice class server-group 303
 ipv4 192.168.80.60 port 5065
!
voice class server-group 305
 ipv4 192.168.80.60
!
voice class server-group 307 
 ipv4 192.168.80.60
!
voice class tenant 200
 registrar dns:40462196.cisco-bcld.com scheme sips expires 240 refresh-ratio 50 tcp tls
 credentials number Hussain6346_LGU username Hussain2572_LGU password 0 meX7]~)VmF realm BroadWorks
 authentication username Hussain2572_LGU password 0 meX7]~)VmF realm BroadWorks
 authentication username Hussain2572_LGU password 0 meX7]~)VmF realm 40462196.cisco-bcld.com
 no remote-party-id
 sip-server dns:40462196.cisco-bcld.com
 connection-reuse
 srtp-crypto 200
 session transport tcp tls
 url sips
 error-passthru
 asserted-id pai
 bind control source-interface GigabitEthernet0/0/1
 bind media source-interface GigabitEthernet0/0/1
 no pass-thru content custom-sdp
 sip-profiles 200
 outbound-proxy dns:la01.sipconnect-us10.cisco-bcld.com
 privacy-policy passthru
!
voice class tenant 100 
 session transport udp
 url sip
 error-passthru
 bind control source-interface GigabitEthernet0/0/0
 bind media source-interface GigabitEthernet0/0/0
 no pass-thru content custom-sdp
!
voice class tenant 300 
 bind control source-interface GigabitEthernet0/0/0
 bind media source-interface GigabitEthernet0/0/0
 no pass-thru content custom-sdp
!
dial-peer voice 100 voip
 description Incoming dial-peer from PSTN
 session protocol sipv2
 destination dpg 302
 incoming uri via 100
 voice-class codec 99
 dtmf-relay rtp-nte
 voice-class sip tenant 300
 no vad
!
dial-peer voice 101 voip 
 description Outgoing dial-peer to IP PSTN
 destination-pattern BAD.BAD
 session protocol sipv2
 session target ipv4:192.168.80.13
 voice-class codec 99
 dtmf-relay rtp-nte
 voice-class sip tenant 100
 no vad
!
dial-peer voice 200201 voip
 description Inbound/Outbound Webex Calling
 max-conn 250
 destination dpg 300
 incoming uri request 200
 destination-pattern BAD.BAD
 session protocol sipv2
 session target sip-server
 voice-class codec 99
 dtmf-relay rtp-nte
 voice-class stun-usage 200
 no voice-class sip localhost
 voice-class sip tenant 200
 srtp
 no vad
!
dial-peer voice 300 voip
 description Incoming dial-peer from CUCM for Webex Calling
 session protocol sipv2
 destination dpg 200
 incoming uri via 300
 voice-class codec 99
 dtmf-relay rtp-nte
 voice-class sip tenant 300
 no vad
!
dial-peer voice 301 voip
 description Outgoing dial-peer to CUCM-Group-1 for inbound from Webex Calling - Nodes 1 to 5
 destination-pattern BAD.BAD
 session protocol sipv2
 session server-group 301
 voice-class codec 99
 voice-class sip bind control source-interface GigabitEthernet 0/0/2
 voice-class sip bind media source-interface GigabitEthernet 0/0/2
 dtmf-relay rtp-nte
 voice-class sip tenant 100
 no vad
!
dial-peer voice 302 voip
 description Incoming dial-peer from CUCM for PSTN
 session protocol sipv2
 destination dpg 100
 incoming uri via 302
 voice-class codec 99
 dtmf-relay rtp-nte
 voice-class sip tenant 300
 no vad
!
dial-peer voice 303 voip
 description Outgoing dial-peer to CUCM-Group-2 for inbound from Webex Calling - Nodes 6 to 10
 destination-pattern BAD.BAD
 session protocol sipv2
 session server-group 303
 voice-class codec 99
 voice-class sip bind control source-interface GigabitEthernet 0/0/2
 voice-class sip bind media source-interface GigabitEthernet 0/0/2
 dtmf-relay rtp-nte
 voice-class sip tenant 100
 no vad
!
dial-peer voice 305 voip
 description Outgoing dial-peer to CUCM-Group-1 for inbound from PSTN - Nodes 1 to 5
 destination-pattern BAD.BAD
 session protocol sipv2
 session server-group 305
 voice-class codec 99 
 voice-class sip bind control source-interface GigabitEthernet 0/0/2
 voice-class sip bind media source-interface GigabitEthernet 0/0/2
 dtmf-relay rtp-nte
 voice-class sip tenant 100
 no vad
!
dial-peer voice 307 voip
 description Outgoing dial-peer to CUCM-Group-2 for inbound from PSTN - Nodes 6 to 10
 destination-pattern BAD.BAD
 session protocol sipv2
 session server-group 307
 voice-class codec 99  
 voice-class sip bind control source-interface GigabitEthernet 0/0/2
 voice-class sip bind media source-interface GigabitEthernet 0/0/2
 dtmf-relay rtp-nte
 voice-class sip tenant 100
 no vad
!
